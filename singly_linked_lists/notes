#include <stdlib.h>   // pour malloc, free, NULL
#include <string.h>   // pour strdup
#include "lists.h"    // pour la structure list_t et le prototype

/**
 * add_node - ajoute un nouveau nœud au début d'une list_t
 * @head: pointeur vers le pointeur de tête de liste (list_t **)
 * @str: chaîne à copier dans le nouveau nœud
 *
 * Return: adresse du nouveau nœud, ou NULL en cas d'échec
 */
list_t *add_node(list_t **head, const char *str)
{
    list_t *new;           // futur nouveau nœud
    unsigned int len = 0;  // longueur de la chaîne (calculée manuellement)

    /* ==================== 1. Protection de base ==================== */
    if (!head)             // si quelqu'un passe NULL à la place de &ma_liste
        return (NULL);

    /* ==================== 2. Allocation du nœud ==================== */
    new = malloc(sizeof(list_t));
    if (new == NULL)       // malloc peut échouer → test OBLIGATOIRE
        return (NULL);     // ici on quitte sans toucher à rien → safe

    /* ==================== 3. Duplication de la chaîne ==================== */
    new->str = strdup(str);           // strdup = malloc + strcpy en un seul appel
                                      // strdup(NULL) retourne NULL → c'est normal
    if (new->str == NULL)             // si strdup échoue (ou si str == NULL)
    {
        free(new);                    // on libère le nœud qu'on avait mallocé
        return (NULL);                // → zéro leak, zéro segfault
    }

    /* ==================== 4. Calcul de la longueur À LA MAIN ==================== */
    // Pourquoi ? Parce que le checker interdit strlen sur certaines tâches
    while (str && str[len])   // tant que str existe et que le caractère n'est pas '\0'
        len++;                // on incrémente len
    new->len = len;           // on stocke la longueur (sans le '\0')

    /* ==================== 5. Insertion en tête de liste ==================== */
    new->next = *head;        // l'ancien premier nœud devient le suivant
    *head = new;              // le nouveau nœud devient la nouvelle tête
                              // → grâce au double pointeur, la modification est visible dans main !

    /* ==================== 6. Retour du nouveau nœud ==================== */
    return (new);             // le checker vérifie souvent que tu retournes bien l'adresse
}
